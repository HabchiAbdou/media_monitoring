{% extends "base.html" %}
{% load static %}
{% load i18n_fr %}

{% block title %}{{ "Reports subtitle"|t }} | Media Monitoring{% endblock %}

{% block content %}
<form id="report-generate-form" method="post" action="{% url 'monitoring:report' %}">
    {% csrf_token %}
</form>

<section class="hero">
    <div class="hero-inner">
        <div class="hero-text">
            <p class="eyebrow">{{ "Reports heading"|t }}</p>
            <h1>{{ "Reports heading"|t }}</h1>
            <p class="lede">{{ "Reports subheading"|t }}</p>
            <div class="hero-actions">
                <button class="btn primary" type="submit" form="report-generate-form" name="format" value="pdf">{{ "Generate PDF"|t }}</button>
                <button class="btn ghost dark" type="submit" form="report-generate-form" name="format" value="csv">{{ "Download CSV"|t }}</button>
            </div>
        </div>
        <div class="hero-icon" aria-hidden="true">
            <img src="{% static 'img/ocp-logo.png' %}" alt="OCP logo">
        </div>
    </div>
</section>

<section class="stats-grid">
    <div class="stat-card">
        <p class="stat-label">{{ "Total Reports"|t }}</p>
        <p class="stat-value">{{ total_mentions|default_if_none:"24" }}</p>
        <p class="stat-note">{{ "Across all sources."|t }}</p>
    </div>
    <div class="stat-card">
        <p class="stat-label">{{ "This Month"|t }}</p>
        <p class="stat-value">{{ companies_count|default_if_none:"8" }}</p>
        <p class="stat-note">{{ "With coverage."|t }}</p>
    </div>
    <div class="stat-card">
        <p class="stat-label">{{ "Avg. Response Time"|t }}</p>
        <p class="stat-value">2.4h</p>
        <p class="stat-note">{{ "Tracked categories."|t }}</p>
    </div>
</section>

<section class="panel report-list">
    <div class="panel-header">
        <div>
            <p class="eyebrow">{{ "Reports heading"|t }}</p>
            <h2>{{ "Available Reports"|t }}</h2>
        </div>
    </div>

    {% if source_reports %}
        {% for report in source_reports %}
            <div class="report-row">
                <div class="report-copy">
                    <h3>{{ report.source__name }}</h3>
                    <p class="muted">{{ report.source__type__name }}</p>
                    <p class="meta-line">
                        {{ report.total_mentions }} {{ "Mentions"|t|lower }}
                        {% if report.urgent_mentions %}
                            Â· {{ report.urgent_mentions }} {{ "Urgent mentions"|t|lower }}
                        {% endif %}
                    </p>
                </div>
                <form class="report-actions" method="post" action="{% url 'monitoring:report' %}">
                    {% csrf_token %}
                    <input type="hidden" name="source_id" value="{{ report.source_id }}">
                    <button class="btn ghost light" type="submit" name="format" value="view">{{ "View"|t }}</button>
                    <button class="btn primary" type="submit" name="format" value="pdf">{{ "Download"|t }}</button>
                </form>
            </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p class="muted">{{ "No reports yet."|t }}</p>
            <p class="muted">{{ "Reports will be generated from live sources."|t }}</p>
        </div>
    {% endif %}
</section>
{% endblock %}
